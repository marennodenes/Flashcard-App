@startuml class
!theme plain
skinparam monochrome true
skinparam shadowing false
!pragma layout smetana
title flashcards class diagram

package core {

    class Flashcard {
        - int number
        - String question
        - String answer

        + Flashcard()
        + Flashcard(String question, String answer)
        + Flashcard(int number, String question, String answer)
        + String getQuestion()
        + void setQuestion(String question)
        + void setAnswer(String answer)
        + String getAnswer()
        + int getNumber()
        + void setNumber(int number)
        + String toString()
    }

    class FlashcardDeck {
        - String deckName
        - List<Flashcard> deck

        + FlashcardDeck()
        + FlashcardDeck(String deckName)
        + List<Flashcard> getDeck()
        + void setDeck(List<Flashcard> deck)
        + String getDeckName()
        + void setDeckName(String deckName)
        + void addFlashcard(Flashcard flashcard)
        + boolean removeFlashcardByIndex(int index)
        + boolean isQuestion(String current)
    }

    class FlashcardDeckManager {
        - List<FlashcardDeck> decks
        - {static} int MAX_DECKS = 8

        + List<FlashcardDeck> getDecks()
        + void addDeck(FlashcardDeck deck)
        + void removeDeck(FlashcardDeck deck)
        + void setDecks(List<FlashcardDeck> decks)
    }

    class LoginValidator {
        - UserPersistence PERSISTENCE
        
        + LoginValidator(UserPersistence persistence)
        + boolean createUser(String username, String password)
        + boolean isUsernameUnique(String username)
        + boolean equalPasswords(String password, String confirmedPassword)
        + boolean authenticateUser(String username, String password)
        + User findUserByUsername(String username)
    }

    class PasswordEncoder {
        - {static} String ALGORITHM = "SHA-256"
        - {static} int SALT_LENGTH = 16
        - {static} SecureRandom SECURE_RANDOM

        + {static} String encode(String password)
        + {static} boolean matches(String password, String encodedPassword)
    }

    class User {
        - String username
        - String password

        + User()
        + User(String username, String password)
        + String getUsername()
        + String getPassword()
    }

    class UserData {
        - User user
        - FlashcardDeckManager deckManager

        + UserData()
        + UserData(User user, FlashcardDeckManager deckManager)
        + UserData(User user)
        + User getUser()
        + FlashcardDeckManager getDeckManager()
        + void setDeckManager(FlashcardDeckManager deckManager)
    }

    interface UserPersistence {
        + boolean userExists(String username)
        + User readUserData(String username)
        + void writeUserData(User user)
    }
}

package storage {
    class FlashcardPersistent {
        - ObjectMapper objectMapper

        + FlashcardPersistent()
        + void writeDeck(String username, FlashcardDeckManager deckManager)
        + FlashcardDeckManager readDeck(String username) 
        + boolean dataExists(String username)
        + User readUserData(String username)
        + void writeUserData(User user)
        + boolean userExists(String username)
    }
}

package ui {
    class ApiClient{

    }

    class FlashcardApp {

    }

    class FlashcardController {
        
    }

    class FlashcardDeckController {
        
    }

    class FlashcardLoginController {
        
    }

    class FlashcardMainController {
       
    }

    class FlashcardSignUpController {

    }
}

package server {
    package controller {
        class DeckController {
            - DeckService deckService
            - FlashcardDeckMapper mapper
            
            + DeckController(DeckService deckService)
            + ApiResponse<FlashcardDeckManagerDto> getAllDecks(String username)
            + ApiResponse<FlashcardDeckDto> getDeckByName(String username, String deckName)
            + ApiResponse<FlashcardDeckDto> createDeck(String username, String deckName)
            + ApiResponse<Void> deleteDeck(String username, String deckName)
            + ApiResponse<Void> updateAllDecks(String username, FlashcardDeckManagerDto deckManagerDto)
        }

        class FlashcardController {
            - FlashcardService flashcardService
            - FlashcardMapper flashcardMapper

            + FlashcardController(FlashcardService flashcardService)
            + ApiResponse <FlashcardDto> createFlashcard(String username, String deckname, String question, String answer)
            + ApiResponse<Void> deleteFlashcard(String username, String deckName, int flashcardNumber)
            + ApiResponse <FlashcardDto> getFlashcard(String username, String deckname, int number)
            + ApiResponse <List<FlashcardDto>> getAllFlashcards(String username, String deckname)   
        }

        class UserController {
            - UserService userService
            - UserMapper userMapper

            + UserController(UserService userService)
            + ApiResponse<UserDto> getUser(String username)
            + ApiResponse<Void> createUser(LoginRequestDto request)
            + ApiResponse<LoginResponseDto> loginUser(LoginRequestDto request)
            + ApiResponse<Boolean> validatePassword(String username, String password)
            + ApiResponse<Boolean> findUser(String username)
        }
    }

    package service {
        class DeckService {
            - FlashcardPersistent flashcardPersistent

            + DeckService()
            + FlashcardDeckManager getAllDecks(String username)
            + FlashcardDeck getDeck(String username, String deckName)
            + FlashcardDeck createDeck(String username, String deckName)
            + void deleteDeck(String username, String deckName)
            + void updateAllDecks(String username, FlashcardDeckManager deckManager)
        }

        class FlashcardService {
            - FlashcardPersistent flashcardPersistent
            - DeckService deckService

            + FlashcardService()
            - FlashcardService(FlashcardPersistent flashcardPersistent, DeckService deckService)
            + Flashcard getFlashcard(String username, String deckname, int number)
            + List<Flashcard> getAllFlashcards(String username, String deckname)
            + Flashcard createFlashcard(String username, String deckname, String answer, String question)
            + void deleteFlashcard(String username, String deckName, int number)
        }

        class UserService {
            - FlashcardPersistent persistent

            + UserService()
            + User getUser(String username)
            + User createUserWithValidation(String username, String password)
            + User createUser (String username, String password)
            + boolean userExists(String username)
            + boolean logInUser(String username, String password)
            + boolean validatePassword(String username, String password)
            + String validatePasswordDetailed(String password)
            + boolean isValidPassword(String password)
        }
    }
}

package shared {
    package dto {
        class FlashcardDeckDto {
            - String deckName
            - List<FlashcardDto> deck

            + FlashcardDeckDto()
            + FlashcardDeckDto(String deckName, List<FlashcardDto> deck)
            + String getDeckName()
            + List<FlashcardDto> getDeck()
        }

        class FlashcardDeckManagerDto {
            - List<FlashcardDeckDto> decks

            + FlashcardDeckManagerDto()
            + FlashcardDeckManagerDto(List<FlashcardDeckDto> decks)
            + List<FlashcardDeckDto> getDecks()
        }

        class FlashcardDto {
            - String question
            - String answer
            - int number

            + FlashcardDto()
            + FlashcardDto(String question, String answer, int number)
            + String getQuestion()
            + String getAnswer()
            + int getNumber()
        }

        class LoginRequestDto {
            - String username
            - String password

            + LoginRequestDto()
            + LoginRequestDto(String username, String password)
            + String getUsername()
            + void setUsername(String username)
            + String getPassword()
            + void setPassword(String password)
        }

        class LoginResponseDto {
            - String success
            - String message
            - UserDataDto userData

            + LoginResponseDto()
            + LoginResponseDto(String success, String message, UserDataDto userData)
            + boolean isSuccess()
            + String getMessage()
            + UserDataDto getUserData()
        }

        class UserDataDto {
            - String username
            - String password
            - FlashcardDeckManagerDto deckManager

            + UserDataDto()
            + UserDataDto(String username, String password)
            + UserDataDto(String username, String password, List<FlashcardDeckManagerDto> decks)
            + String getUsername()
            + String getPassword()
            + FlashcardDeckManagerDto getDeckManager()
        }

        package mappers {
            class FlashcardDeckMapper {
                + FlashcardDeckDto toDto(FlashcardDeck deck)
                + FlashcardDeck fromDto(FlashcardDeckDto dto)
                + List<FlashcardDeckDto> toDtoList(List<FlashcardDeck> decks)
                + List<FlashcardDeck> fromDtoList(List<FlashcardDeckDto> dtoList)
            }

            class FlashcardMapper {
                + FlashcardDto toDto(Flashcard flashcard)
                + Flashcard fromDto(FlashcardDto dto)
                + List<FlashcardDto> toDtoList(List<Flashcard> flashcards)
                + List<Flashcard> fromDtoList(List<FlashcardDto> dtoList)
            }

            class UserMapper {
                + UserDataDto toDto(User user)
                + UserDataDto toDto(UserData userData)
                + User fromDto(UserDataDto dto)
                + User fromLoginrequestDto(LoginRequestDto dto)
            }
        }
    }

    package shared {
        class ApiConstants {
            - String USER_NOT_FOUND
            - String USER_CREATED
            - String USER_UPDATED
            - String USER_ALREADY_EXISTS
            - String LOGIN_FAILED
            - String LOGIN_SUCCESS
            - String INVALID_PASSWORD
            - String PASSWORD_TOO_SHORT
            - String PASSWORD_MISSING_UPPERCASE
            - String PASSWORD_MISSING_LOWERCASE
            - String PASSWORD_MISSING_DIGIT
            - String PASSWORD_MISSING_SPECIAL
            - String FLASHCARD_NOT_FOUND
            - String FLASHCARD_CREATED
            - String FLASHCARD_DELETED
            - String DECK_NOT_FOUND
            - String DECK_CREATED
            - String DECK_DELETED
            - String INVALID_REQUEST
        }

        class ApiEndpoints {
            - {static} String SERVER_HOST
            - {static} String SERVER_PORT
            - {static} String SERVER_BASE_URL
            - {static} String BASE
            - {static} String USERS
            - {static} String LOGIN
            - {static} String REGISTER
            - {static} String FLASHCARDS
            - {static} String FLASHCARD_CREATE
            - {static} String FLASHCARD_GET
            - {static} String FLASHCARD_GET_ALL
            - {static} String FLASHCARD_DELETE
            - {static} String DECKS
            - {static} String DECK_CREATE
            - {static} String DECK_GET
            - {static} String DECK_GET_ALL
            - {static} String DECK_DELETE
            - {static} String USERS_V1
            - {static} String USER_REGISTER
            - {static} String USER_LOGIN
            - {static} String USER_LOGOUT
            - {static} String USER_VALIDATE_PASSWORD
            - {static} String USER_PROFILE
            - {static} String USER_FIND
            - {static} String LOGIN_URL
            - {static} String REGISTER_URL

            + ApiEndpoints()
            + String getUserDecksUrl(String username)
        }

        class ApiResponse<T> {
            - boolean success
            - String message
            - T data

            + ApiResponse()
            + ApiResponse(boolean success, String message, T data)
            + boolean isSuccess()
            + void setSuccess(boolean success)
            + String getMessage()
            + void setMessage(String message)
            + T getData()
            + void setData(T data)
        }   
    }
}

' Relationships

' Core package relationships
FlashcardDeck "1" *-- "0..*" Flashcard : contains
FlashcardDeckManager "1" *-- "0..*" FlashcardDeck : manages
UserData "1" *-- "1" User : contains
UserData "1" *-- "1" FlashcardDeckManager : contains
FlashcardPersistent ..|> UserPersistence : implements
LoginValidator --> UserPersistence : uses

' Storage relationships
FlashcardPersistent ..> FlashcardDeckManager : persists/loads
FlashcardPersistent ..> User : persists/loads
FlashcardPersistent ..> UserData : persists/loads

' Server service relationships
DeckService --> FlashcardPersistent : uses
FlashcardService --> FlashcardPersistent : uses
FlashcardService --> DeckService : uses
UserService --> FlashcardPersistent : uses

' Server controller relationships
DeckController --> DeckService : uses
DeckController --> FlashcardDeckMapper : uses
FlashcardController --> FlashcardService : uses
FlashcardController --> FlashcardMapper : uses
UserController --> UserService : uses
UserController --> UserMapper : uses

' Mapper relationships
FlashcardDeckMapper ..> FlashcardDeck : converts
FlashcardDeckMapper ..> FlashcardDeckDto : converts
FlashcardMapper ..> Flashcard : converts
FlashcardMapper ..> FlashcardDto : converts
UserMapper ..> User : converts
UserMapper ..> UserData : converts
UserMapper ..> UserDataDto : converts

' DTO relationships
FlashcardDeckDto "1" *-- "0..*" FlashcardDto : contains
FlashcardDeckManagerDto "1" *-- "0..*" FlashcardDeckDto : contains
UserDataDto "1" *-- "1" FlashcardDeckManagerDto : contains
LoginResponseDto "1" *-- "0..1" UserDataDto : contains

' UI relationships (REST client - no direct core dependencies)
FlashcardMainController --> ApiClient : uses
FlashcardDeckController --> ApiClient : uses
FlashcardController --> ApiClient : uses
FlashcardLoginController --> ApiClient : uses
FlashcardSignUpController --> ApiClient : uses
ApiClient --> ApiResponse : uses
ApiClient --> ApiEndpoints : uses

@enduml